#!/bin/bash

if [ $# -ne 1 ]
then
    echo "Usage: $(basename $0) FILE"
    exit 1
fi

FILE="$1.h"
NAME=$(echo $(basename $1) | sed 's/[^a-zA-Z0-9_]/_/g')

echo "// this is autogenerated file: do not edit" > "$FILE"
echo "// clang-format off" >> "$FILE"
echo "#ifndef ${NAME}_h_" >> "$FILE"
echo "#define ${NAME}_h_" >> "$FILE"
echo "constexpr const char* $NAME = " >> "$FILE"

cat "$1" | sed '/^$/d' | sed '/^#/d' | while IFS='' read -r line || [[ -n "$line" ]]; do
    line=$(echo "$line" | sed 's/\\/\\\\/g' | sed 's/"/\\"/g')
    echo "\"$line\\n\"" >> "$FILE"
done

echo ";" >> "$FILE"
echo "#endif" >> "$FILE"
echo "// clang-format on" >> "$FILE"


